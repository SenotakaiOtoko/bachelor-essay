\section{Аналитическая часть}\label{analytics}

\subsection{Постановка задачи}\label{problem-formulation}

Конечная цель проектирования --- разработка архитектуры программного решения, предназначенного для хранения и публикации фотографий в сети интернет.

Онлайн сервис для публикации фотографий должен обладать следующими характеристиками:
\begin{itemize}
    \item возможность загрузки и хранения фотографий с возможностью просмотра и дальнейшего скачивания;
    \item организация хранилища фотографий пользователей в автоматическом или полуавтоматическом режиме с возможностью осуществления дальнейшего поиска по необходимым критериям;
    \item возможность публикации фотографий в сети интернет;
    \item индексирование загружаемых фотографий по цветам для осуществления возможности дальнейшего поиска фотографий по цветам;
    \item возможность комментирования и оценивания фотографий, загруженных в сервис;
    \item возможность обмена сообщениями с другими пользователями;
    \item автоматическая классификация фотографий по набору тегов;
    \item задание пользовательских тегов;
    \item поиск фотографии по кластерам цветов.
\end{itemize}

Для обеспечения безопасной и непрерывной работы пользователями программное решение должно отвечать следующим требованиям:
\begin{itemize}
    \item Парольная аутентификация и разграничение прав доступа пользователей;
    \item Регистрация пользователей с подтверждением прохождения регистрации посредством email или смс;
    \item Протоколирование действий пользователей.
\end{itemize}

Для разработки фотохостинга необходима реализация следующих этапов:
\begin{itemize}
    \item изучение и анализ предметной области;
    \item выбор технологий реализации;
    \item проектирование архитектуры приложения;
    \item обоснование выбора средств программной реализации;
    \item реализация продукта минимальной жизнедеятельности;
    \item запуск в эксплуатацию продукта минимальной жизнедеятельности;
    \item тестирование продукта минимальной жизнедеятельности на конечных пользователях;
    \item реализация продукта;
    \item запуск в эксплуатацию продукта.
\end{itemize}

\subsection{Сравнительный анализ конкурирующих решений} \label{comparsion}

На сегодняшний день существует большое количество решений, готовых предоставить услуги по хранению фотографий в сети.
Данная услуга имеет массу плюсов для конечных пользователей, и самый главный  - возможность представить фотографии в виде Web-альбома, созданного с помощью соответствующего решения, а не просто в виде бессистемного набора изображений.
Но подобный вариант автоматически накладывает определенные сложности. 
Это относится к тому случаю, когда пользователь предназначает созданный фотоальбом не только для того, чтобы альбом просматривали, знающие его Web-адрес, но и для расширенного круга посетителей, например для выяснения мнения профессионалов по поводу качества изображений.
В этом случае не избежать стандартной процедуры регистрации и раскрутки сайта, поскольку сделать сайт посещаемым — это отдельная и серьезная работа, которая потребует немало времени и специальных знаний.
Каждый день появляются новые сервисы для хранения фотографий, сильно похожие на существующие аналоги.
Сервисы соревнуются в типовых характеристиках, таких, как максимальное разрешение загружаемой фотографии, максимально возможное количество загруженных фотографий, тем самым они не педлагают пользователям нового функционала, связанного с организацией хранилища фотографий.
Сравнение ведущих решений для хранения фотографий представлены в таблице \ref{comp-table}

\begin{table}[H]
  \caption{Функциональность конкуриррующих продуктов}\label{comp-table}
  \begin{spacing}{1}
  \small
  \begin{tabular}{|p{3cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|p{2.5cm}|}
  \hline Сравнение особенностей & Конкурент А фотохостинг & Конкурент В фотохостинг & Конкурент C фотохостинг & Конкурент D фотохостинг & Конкурент E фотохостинг \\ 
  \hline URL компании & flickr.com & 500px.com & photos.google.com & disk.yandex.ru & apple.com \\ 
  \hline Классификация продукта & Фотохостинг-соцсеть & Фотохостинг-соцсеть & Фотохостинг & Фотохостинг & Локальный фотохостинг \\ 
  \hline Варианты клиентов & Android, iOS, web & Android, iOS, web & Android, iOS, web & Android, iOS, web & OSX \\ 
  \hline Объем бесплатного хранилища & 1 tb & 7 фото в неделю & ∞ if size <16Mp & 10 gb & Локальное хранилище \\ 
  \hline Загрузка исходников фотографиии & - & - & + & + & + \\ 
  \hline Теги & + & + & + & - & - \\ 
  \hline Настройки приватности для фотографии & + & - & + & + & - \\ 
  \hline Настройки лицензирования & + & + & - & - & - \\ 
  \hline Встроенный фоторедактор & + & - & + & + & + \\ 
  \hline Комментирование & + & + & - & - & - \\ 
  \hline Сохранение фотографий других людей & + & + & - & - & - \\ 
  \hline Скачивание оригинала фотографии & + & - & + & + & + \\ 
  \hline Скачивание фотографии в нескольких размерах & + & - & - & - & - \\ 
  \hline Навигация с помощью клавиш & + & + & + & - & + \\ 
  \hline Просмотр ссводной статистики & + & + & - & - & - \\ 
  \hline Замена фотографии & + & - & - & - & - \\ 
  \hline Авторасстановка тегов & - & - & + & - & - \\ 
  \hline Распознавание лиц & - & - & + & - & + \\ 
  \hline Распознавание разных людей & - & - & - & - & + \\ 
  \hline Модерирование комментариев & + & + & - & - & - \\ 
  \hline Автозащита фотографий внутри сервиса от копирования & - & - & - & - & - \\ 
  \hline Чтение информации из exif & + & + & - & - & + \\ 
  \hline Лента актуальных публичных фотографий & + & + & - & - & - \\ 
  \hline Монетизация & - & + & - & - & - \\ 
  \hline Суммарное количество особенностей на сайте & 15 & 11 & 9 & 5 & 7 \\ 
  \hline Рейтинг эффективности & ***** & **** & *** & * & ** \\
  \hline
  \end{tabular}
  \end{spacing}
\end{table}

\subsection{Организация хранилища фотографий}

Большинство фотографов хранят исходники или обработанные фотографии на локальных носителях.
Данный способ хранения имеет ряд существенных недостатков, как например, ненадежность массово используемых решений и трудность организации фотографий стандартными средствами ОС.
А инструменты, предоставляющие хранение фотографий в сети сильно ограничены.
Одной из функций, улучшающих опыт использования от сервиса была бы возможность в автоматическом, или полуавтоматическом режиме организовывать хранилище фотографий, тем самым снимая данную нагрузку с пользователя.
Это возможно благодаря индексации фотографий в сервисе сразу после их загрузки. 
Фотография классифицируется и помечается тегом принадлежности к набору классов.
Также выделяются цветовые кластеры на фотографии для дальнейшей возможности поиска фотографии по набору преобладающих на ней цваетов.
Предполагается возможность формирования альбомов с фотографиями "на лету", после ввода пользователем общих критериев, объединяющих сразу несколько фотографий по проиндексированным при загрузке признакам.


В настоящий момент на рынке не так много решений по хранению фотографий, классифицирующих или категоризирующих изображения.
Подобных решений по хранению фотографий непосредственно в сети еще меньше.
Одними из немногих и самым популярным среди таковых является сервис Google Photo. 
В Google Photo можно бесплатно загружать фотографии, размер которых не превышает 16 МПикс в формате jpeg. 
Сразу после загрузки фотографии индексируются для дальнейшего поиска по ключевым словам.
При этом результаты индексирования остаются полностью скрытыми от пользователя. 
В таком случае, если нейронная сеть ошиблась, пользователь никогда об этом не узнает, или по крайней мере, никак не сможет на это повлиять. 
Например, нейронная сеть может распознать класс там, где его на самом деле нет или не распознать класс там, где он присутствует.

\subsection{Применение нейронной сети для задачи классификации}

Для задач классификации изображений наилучшие результаты показывает Convolutional Neural Network или сверточная нейронная сеть, которая является логическим развитием идей таких архитектур нейронных сетей как когнитрона и неокогнитрона. 
Успех обусловлен возможностью учета двумерной связности изображения, в отличие от многослойного персептрона \ref{conv-neoro}. 

Сверточные нейронные сети обеспечивают частичную устойчивость к изменениям масштаба, смещениям, поворотам, смене ракурса и прочим искажениям. 
Сверточные нейронные сети объединяют три архитектурных идеи, для обеспечения инвариантности к изменению масштаба, повороту сдвигу и пространственным искажениям:
\begin{itemize}
    \item локальные рецепторные поля (обеспечивают локальную двумерную связность нейронов);
    \item общие синаптические коэффициенты (обеспечивают детектирование некоторых черт в любом месте изображения и уменьшают общее число весовых коэффициентов);
    \item иерархическая организация с пространственными подвыборками.
\end{itemize}

На данный момент сверточная нейронная сеть и ее модификации считаются лучшими по точности и скорости алгоритмами нахождения объектов на сцене. 
Начиная с 2012 года, сверточные нейронные сети занимают первые места на известном международном конкурсе по распознаванию образов ImageNet.

Именно поэтому принято решение о дальнейшем использовании сверточных нейронных сетей. 
Наиболее интересными представителями класса сверточных нейронных сетей являются сети «GoogleNet», «InceptionV3» и «VGG16».

VGG16 — модель сверточной нейронной сети, предложенная K. Simonyan и A. Zisserman из Оксфордского университета \ref{vgg16alg}. 
Модель достигает точности 92.7\% — топ-5, при тестировании на подмножестве данных ILSVRC-2014 (ImageNet Large Scale Visual Recognition Challenge — Кампания по широкомасштабному распознаванию образов в ImageNet) множества ImageNet в задаче распознавания объектов на изображении. 

Топ 5 — метрика, в которой алгоритм может выдать 5 вариантов класса картинки. Ошибка засчитывается, если среди всех этих вариантов нет правильного. В тестовом наборе данных 150 тысяч картинок и 1000 категорий, то есть задача крайне нетривиальна.

Это одна из самых известных моделей сверточной нейронной сети, которая была отправлена на соревнование ILSVRC-2014. Она является улучшенной версией нейронной сети AlexNet, которая была первой сверточной нейронной сетью, победившей в ILSVRC \ref{imagenet-challenge}.
 
Что-то представлено на рис. \ref{alexnet-structure}.
\addimg{alexnet-structure}{0.8}{Структура нейронной сети AlexNet}{alexnet-structure}

В VGG16 по сравнению с сетью AlexNet были заменены большие фильтры (размера 11 и 5 в первом и втором сверточном слое, соответственно) на несколько фильтров размера 3х3, следующих один за другим. Сеть VGG16 для конкурса обучалась на протяжении нескольких недель при использовании видеокарт NVIDIA TITAN BLACK. 

\addimg{vgg-structure}{0.8}{Структура нейронной сети VGG16}{vgg-structure}

GoogLeNet – сверточная нейронная сеть, спроектированная компанией Google и выигравшая ILSVRC-2014 с результатом точности 93,33\% топ 5 \ref{imagenet-challenge}.
Сеть AlexNet, победившая в 2012 году не помещалась в память одного графического ускорителя, объем памяти которого составлял 3GB. 
Одной из главных идей GoogLeNet была эффективность вычислений при небольшом размере модели и небольшом количестве самих вычислений, например, чтобы можно было использовать нейронную сеть на носимых устройствах.

\addimg{inception-block}{0.35}{Структура блока inception сети GoogLeNet}{inception-block}

\addimg{googlenet-structure}{0.8}{Структура нейронной сети GoogLeNet}{googlenet-structure}

При проектировании сети GoogLeNet также учитывались недостатки нейронной сети AlexNet. 

В структуре AlexNet производились большие свертки, которые требуют много параметров, в GoogLeNet свертки стали меньше, однако увеличилось количество слоев в свертках.

После чего было произведено сильное уменьшение количества измерений, чтобы компенсировать более толстые слои. 
Данная операция производилась с помощью слоя, выполняющего роль линейного фильтра, примененного по всему изображению, чтобы линейно смешать текущее количество измерений в меньшее.

На каждом из уровней использовалось одновременно несколько подобных фильтров разного размера. 
Это делалось для того, чтобы улавливать градиентные участки изображения разного масштаба.

В GoogLeNet отсутствуют полносвязные слои, так как в них слишком много параметров. 
Вместо этого на последнем уровне выполняется операция субдескритезации, после которой информация подается непосредственно на выходной слой.

Данные манипуляции позволили примерно в 10 раз сократить количество параметров нейронной сети по сравнению в AlexNet, как следствие и количество вычислений, производимых при обучении и непосредственной работе нейронной сети.

InceptionV3 – дальнейшее развитие идеи эффективных сверточных нейронных сетей от Google. Данная нейронная сеть достигает точности 92,8\% топ 5 на ILSVRC-2015 \ref{imagenet-challenge}.
 
\addimg{inception-structure}{0.8}{Структура нейронной сети InceptionV3}{inception-structure}

При проектировании InceptionV3, в отличие от первой версии, были сформулированы основные принципы построения архитектуры:
\begin{itemize}
    \item Большое количество сигналов расположены в непосредственной близости друг от друга. Это можно использовать, чтобы делать свертки меньшего размера. Соседние сигналы часто коррелируют, следовательно, можно уменьшить размерность перед сверткой без потери информации.
    \item При увеличении свободного количества ресурсов для их эффективного использования, необходимо увеличивать и глубину и ширину сети одновременно. 
    \item Неэффективно использовать слои, резко уменьшающие количество параметров, особенно в начале нейронной сети.
    \item «Широкие» слои быстрее обучаются, что особенно важно на высоких уровнях (но локально, т.е. можно после них уменьшать размерность)
\end{itemize}

\addimg{inception3-block}{0.35}{Структура блока inception нейронной сети InceptionV3}{inception3-block}

В качестве структуры нейронной сети для дальнейшей работы выбрана InceptionV3, так как она показывает наилучшие результаты по сравнению с другими вышеназванными сверточными нейронными сетями, а также имеет один из лучших показателей эффективности.

\subsection{Выделение цветовых кластеров на изображении}

Для выделения цветовых кластеров на фотографии, при их загрузке на фотохостинг, пиксели на фотографии необходимо кластеризировать.
Так, как заранее не известно количество цветовых кластеров на фотографии, необходимо использовать адаптивный алгоритм, определяющий количество кластеров в процессе работы, также устойчивый к выбросам.
Таким алгоритмом является DBSCAN (Основанная на плотности пространственная кластеризация для приложений с шумами) \ref{dbscan-alg}.

Алгоритм DBSCAN может быть разложен на следующие шаги:
\begin{enumerate}
    \item найти точки в \varepsilon окрестности каждой точки и выделить основные точки с более чем minPts соседями;
    \item найти связные компоненты основных точек на графе соседей, игнорируя все неосновные точки;
    \item назначить каждую неосновную ближайшему кластеру, если кластер является \varepsilon -соседним, в противном случае считать точку шумом.
\end{enumerate}

Хорошей практикой является выбор значения minPts равному рамерности данных, увеличенной на единицу.
Величину \varepsilon можно выбрать из графа k-расстояний\ref{k-graph}:
\begin{enumerate}
    \item вычислить средние расстояния по minPts ближайшим соседям для каждой точки;
    \item отсортировать полученные значения;
    \item выбрать \varepsilon в точке колена получившегося графика.
\end{enumerate}

Так, как данный алгоритм в результате работы не находит центр кластера, необходимо вычислить геометрическую медиану полученных кластеров.
Выполнить данную операцию можно почти за линейное время, используя алгоритм Коэна, Ли, Миллера и Пачоки \ref{median-linear}.
В результате работы алгоритма получаем данные о цветовых харрактеристиках иизображения.

\clearpage